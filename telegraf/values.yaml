image:
  repo: "telegraf"
  tag: "1.22.4"
  pullPolicy: IfNotPresent
## Configure resource requests and limits
## ref: http://kubernetes.io/docs/user-guide/compute-resources/
resources:
  requests:
    memory: 256Mi
    cpu: 0.1
  limits:
    memory: 2Gi
    cpu: 1
## Pod annotations
podAnnotations: {}
## Pod labels
podLabels: {}
## Configure args passed to Telegraf containers
args: []
## The name of a secret in the same kubernetes namespace which contains values to
## be added to the environment (must be manually created)
## This can be useful for auth tokens, etc.
# envFromSecret: "telegraf-tokens"

## Environment
env:
  # This pulls HOSTNAME from the node, not the pod.
  - name: HOSTNAME
    valueFrom:
      fieldRef:
        fieldPath: spec.nodeName
  # In test clusters where hostnames are resolved in /etc/hosts on each node,
  # the HOSTNAME is not resolvable from inside containers
  # So inject the host IP as well
  - name: HOSTIP
    valueFrom:
      fieldRef:
        fieldPath: status.hostIP
  # Mount the host filesystem and set the appropriate env variables.
  # ref: https://github.com/influxdata/telegraf/blob/master/docs/FAQ.md
  # HOST_PROC is required by the cpu, disk, diskio, kernel and processes input plugins
  - name: "HOST_PROC"
    value: "/hostfs/proc"
  # HOST_SYS is required by the diskio plugin
  - name: "HOST_SYS"
    value: "/hostfs/sys"
  - name: "HOST_MOUNT_PREFIX"
    value: "/hostfs"
## Add custom volumes and mounts
# volumes:
# - name: telegraf-output-influxdb2
#   configMap:
#     name: "telegraf-output-influxdb2"
# mountPoints:
# - name: telegraf-output-influxdb2
#   mountPath: /etc/telegraf/conf.d
#   subPath: influxdb2.conf

## Tolerations for pod assignment
## ref: https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/
##
tolerations: []
## If the DaemonSet should run on the host's network namespace
## hostNetwork: true

## If using hostNetwork=true, set dnsPolicy to ClusterFirstWithHostNet
## ref: https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#
## dnsPolicy: ClusterFirstWithHostNet

## If using dnsPolicy=None, set dnsConfig
## ref: https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-dns-config
## dnsConfig:
##   nameservers:
##     - 1.2.3.4
##   searches:
##     - ns1.svc.cluster-domain.example
##     - my.dns.search.suffix
##   options:
##     - name: ndots
##       value: "2"
##     - name: edns0
rbac:
  # Specifies whether RBAC resources should be created
  create: true
serviceAccount:
  # Specifies whether a ServiceAccount should be created
  create: true
  # The name of the ServiceAccount to use.
  # If not set and create is true, a name is generated using the fullname template
  # name:
  # Annotations for the ServiceAccount
  annotations: {}
## Specify priorityClassName
## Ref: https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/
# priorityClassName: system-node-critical

# Specify the pod's SecurityContext, including the OS user and group to run the pod
podSecurityContext: {}
override_config:
  toml: |
   [global_tags]
   ## Change this to the cluster this helm chart is applied to.
   cluster = "k8s-mgmt-observability-01" 
   [agent]
   collection_jitter = "0s"
   debug = false
   flush_interval = "10s"
   flush_jitter = "0s"
   hostname = "$HOSTNAME"
   interval = "10s"
   logfile = "/var/log/telegraf"
   metric_batch_size = 1000
   metric_buffer_limit = 10000
   omit_hostname = false
   precision = ""
   quiet = false
   round_interval = true

   [[outputs.influxdb_v2]]
     bucket = "telegraf-kubernetes"
     insecure_skip_verify = false
     organization = "Visiba"
     token = "8zU2wHcunxrZm1Ld-GqndhekOtNs3kz34a8dyd11veUAEKW6zQHRi08nU45yJwycLu9Wj5Jd3iq5ocZqvJFqZg=="
     urls = [
       "https://influx.visiba.cloud"
     ]

   [[inputs.diskio]]
   [[inputs.kernel]]
   [[inputs.mem]]
   [[inputs.net]]
   [[inputs.processes]]
   [[inputs.swap]]
   [[inputs.system]]
   
   [[inputs.cpu]]
   percpu = true
   totalcpu = true
   collect_cpu_time = false
   report_active = false
   
   [[inputs.disk]]
   ignore_fs = ["tmpfs", "devtmpfs", "devfs", "iso9660", "overlay", "aufs", "squashfs"]
   
   [[inputs.kubernetes]]
   url = "https://$HOSTIP:10250"
   bearer_token = "/var/run/secrets/kubernetes.io/serviceaccount/token"
   insecure_skip_verify = true

   [[inputs.kube_inventory]]
    url = "https://kubernetes.default.svc"
    namespace = ""
    bearer_token = "/var/run/secrets/kubernetes.io/serviceaccount/token"
    insecure_skip_verify = true
  # Provide a literal TOML config

## ref: https://docs.influxdata.com/telegraf/v1.13/administration/configuration/
config:
  # global_tags:
  #   cluster: "mycluster"
  agent:
    interval: "10s"
    round_interval: true
    metric_batch_size: 1000
    metric_buffer_limit: 10000
    collection_jitter: "0s"
    flush_interval: "10s"
    flush_jitter: "0s"
    precision: ""
    debug: false
    quiet: false
    logfile: ""
    hostname: "$HOSTNAME"
    omit_hostname: false
  monitor_self: false
  docker_endpoint: ""
